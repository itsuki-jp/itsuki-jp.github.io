<!DOCTYPE html>
<html lang="ja">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='http://localhost:1313/js/theme-mode.js'></script>
    <link rel="stylesheet" href='http://localhost:1313/css/frameworks.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/github.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/github-style.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/light.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/dark.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/syntax.css' />
    <title>Next.jsのチュートリアル感想戦 - n_itsuki&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github-mark.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="Next.jsのチュートリアルをやってみた" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://localhost:1313/post/nextjs%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E6%84%9F%E6%83%B3%E6%88%A6/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Next.jsのチュートリアル感想戦 - n_itsuki&#39;s blog" />
<meta name="twitter:description"
  content="Next.jsのチュートリアルをやってみた" />
<meta name="twitter:site" content="http://localhost:1313/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="http://localhost:1313/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Next.jsのチュートリアル感想戦 - n_itsuki&#39;s blog">
<meta property="og:description"
  content="Next.jsのチュートリアルをやってみた" />
<meta property="og:url" content="http://localhost:1313/post/nextjs%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E6%84%9F%E6%83%B3%E6%88%A6/" />
<meta property="og:site_name" content="Next.jsのチュートリアル感想戦" />
<meta property="og:image"
  content="http://localhost:1313/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2024-08-18 00:00:00 &#43;0000 UTC" />











</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="http://localhost:1313/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:http://localhost:1313/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="http://localhost:1313/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="http://localhost:1313/">
                  <img class=" avatar-user"
                    src="https://avatars.githubusercontent.com/u/63573439?v=4"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="http://localhost:1313/">n_itsuki</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="http://localhost:1313/post/nextjs%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E6%84%9F%E6%83%B3%E6%88%A6/">Next.jsのチュートリアル感想戦</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Sun, 18 Aug 2024 00:00:00 &#43;0000"
                    class="no-wrap">
                    Sun, 18 Aug 2024 00:00:00 &#43;0000</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      4287 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><p><a href="https://nextjs.org/learn/dashboard-app">Learn Next.js</a>をやってみてのメモ</p>
<p>後半にすすむにつれ、意味が分からなくなり、雑になっていった&hellip;</p>
<p>特にCh13以降(エラー処理・フォームバリデーション・認証と認可)は意味不明だったので、おいおい出来たら良いな～という気持ちです</p>
<h1 id="ch3-optimizing-fonts-and-imageshttpsnextjsorglearndashboard-appoptimizing-fonts-images"><a href="https://nextjs.org/learn/dashboard-app/optimizing-fonts-images">Ch3: Optimizing Fonts and Images</a></h1>
<h2 id="image">Image</h2>
<ul>
<li><code>md:block</code> &lt;-これは、<code>medium</code>らしい</li>
<li><a href="https://nextjs.org/docs/app/building-your-application/optimizing/images">Image Optimization</a></li>
</ul>
<h1 id="ch4-layouts-and-pageshttpsnextjsorglearndashboard-appcreating-layouts-and-pages"><a href="https://nextjs.org/learn/dashboard-app/creating-layouts-and-pages">Ch4: Layouts and Pages</a></h1>
<h2 id="nested-routing">Nested Routing</h2>
<ul>
<li>フォルダ配下の <code>page.tsx</code> は特別で、例えば <code>app/page.tsx</code> は <code>/</code>, <code>app/oyo/page.tsx</code> は <code>/oyo</code> にアクセスすると表示される
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Ffolders-to-url-segments.png&w=3840&q=75"></li>
</ul>
<h2 id="layout">layout</h2>
<ul>
<li><code>layout.tsx</code> は他のページと共有するUIを作れる
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fshared-layout.png&w=3840&q=75"></li>
<li><code>page</code> コンポーネントは再レンダリングされるけど、レイアウトはされないので、（たぶん効率が良い）</li>
</ul>
<h1 id="ch5-navigating-between-pageshttpsnextjsorglearndashboard-appnavigating-between-pages"><a href="https://nextjs.org/learn/dashboard-app/navigating-between-pages">Ch5: Navigating Between Pages</a></h1>
<h2 id="link">Link</h2>
<ul>
<li><code>Link</code>を使うと、ページ丸ごとリロードすることなく遷移できる
<ul>
<li>変わってないじゃん？と思ったが、ブラウザのページのアイコンがぐるぐるしているかどうかで判定できる</li>
</ul>
</li>
<li>コードを<strong>prefetch</strong>してくれるので、クリック時にはすでに目的のページが裏でロードされてる
<ul>
<li>めちゃはやく表示できる</li>
<li>参考：https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works</li>
</ul>
</li>
</ul>
<h2 id="usepathname">usePathname()</h2>
<ul>
<li>クライアントコンポーネントにする必要がある</li>
<li>参考：https://nextjs.org/docs/app/api-reference/functions/use-pathname</li>
</ul>
<h2 id="clsx">clsx</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">clsx</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;flex h-[48px] grow items-center justify-center gap-2 rounded-md bg-gray-50 p-3 text-sm font-medium hover:bg-sky-100 hover:text-blue-600 md:flex-none md:justify-start md:p-2 md:px-3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;bg-sky-100 text-blue-600&#39;</span><span class="o">:</span> <span class="nx">pathname</span> <span class="o">===</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">)}</span>
</span></span></code></pre></div><ul>
<li><code>pathname === link.href</code>の時に、追加で<code>bg-sky-100 text-blue-600</code>が追加される</li>
</ul>
<h1 id="ch6-setting-up-your-databasehttpsnextjsorglearndashboard-appsetting-up-your-database"><a href="https://nextjs.org/learn/dashboard-app/setting-up-your-database">Ch.6: Setting Up Your Database</a></h1>
<ul>
<li>データを DB に登録することを<code>seeding</code>と呼ぶ</li>
</ul>
<h1 id="ch7-fetching-datahttpsnextjsorglearndashboard-appfetching-datausing-server-components-to-fetch-data"><a href="https://nextjs.org/learn/dashboard-app/fetching-data#using-server-components-to-fetch-data">Ch.7: Fetching Data</a></h1>
<h2 id="choosing-how-to-fetch-data">Choosing how to fetch data</h2>
<p>API</p>
<ul>
<li>外部の API を提供してるサービスを使いたい時</li>
<li>データを秘密にしておきたい時</li>
<li><a href="https://nextjs.org/docs/app/building-your-application/routing/route-handlers">https://nextjs.org/docs/app/building-your-application/routing/route-handlers</a></li>
</ul>
<p>データベースクエリ</p>
<ul>
<li>DB をいじいじする必要があるとき</li>
<li>React Server Component を使ってるとき
<ul>
<li>ch11にて再度登場するやつ</li>
<li>DB を直接クエリ操作できる。DB の漏洩をリスクがない</li>
</ul>
</li>
<li><a href="https://vercel.com/docs/storage/vercel-postgres/using-an-orm">https://vercel.com/docs/storage/vercel-postgres/using-an-orm</a></li>
</ul>
<h2 id="react-server-components">React Server Components</h2>
<p>どうやら新しい機能らしい。デフォで使われてる</p>
<p>メリット</p>
<ul>
<li>非同期処理が楽になる？<code>useEffect</code>/<code>useState</code>を使わなくても、<code>async/await</code>が使える？</li>
<li>サーバーで実行されるから
<ul>
<li>結果のみクライアントに送られる（データ・ロジックはサーバーのみが保持できる）</li>
<li>直接 DB をクエリ操作できる</li>
</ul>
</li>
</ul>
<p>問題点</p>
<ul>
<li>
<p><code>request waterfall</code>が発生する</p>
<ul>
<li>
<p>前のリクエストが終了したら、次のが実行される。並列処理されてない</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">revenue</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetchRevenue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">latestInvoices</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetchLatestInvoices</span><span class="p">();</span> <span class="c1">// fetchRevenue()が終わるまで待つ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nx">numberOfInvoices</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nx">numberOfCustomers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nx">totalPaidInvoices</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nx">totalPendingInvoices</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetchCardData</span><span class="p">();</span> <span class="c1">// fetchLatestInvoices()が終わるまで待つ
</span></span></span></code></pre></div><ul>
<li>対処法として、<code>Promise.all()</code>で並列に処理
<ul>
<li>どれかのリクエストがめっちゃ遅かったらどうなる&hellip;?
<ul>
<li>データを動的に読み込むのであれば、遅い処理があればそりゃページ読み込む速度遅くなるよね</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">fetchCardData</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">invoiceCountPromise</span> <span class="o">=</span> <span class="nx">sql</span><span class="sb">`SELECT COUNT(*) FROM invoices`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">customerCountPromise</span> <span class="o">=</span> <span class="nx">sql</span><span class="sb">`SELECT COUNT(*) FROM customers`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">invoiceStatusPromise</span> <span class="o">=</span> <span class="nx">sql</span><span class="sb">`SELECT
</span></span></span><span class="line"><span class="cl"><span class="sb">        SUM(CASE WHEN status = &#39;paid&#39; THEN amount ELSE 0 END) AS &#34;paid&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sb">        SUM(CASE WHEN status = &#39;pending&#39; THEN amount ELSE 0 END) AS &#34;pending&#34;
</span></span></span><span class="line"><span class="cl"><span class="sb">        FROM invoices`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Promise.all()で並列に処理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">+</span> <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="kr">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="nx">invoiceCountPromise</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">customerCountPromise</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">invoiceStatusPromise</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fsequential-parallel-data-fetching.png&w=3840&q=75">
</li>
</ul>
</li>
<li>
<p><code>static rendering</code>(静的レンダリング)なので、データが変化しても表示は変化しない</p>
<ul>
<li>SQL が問い合わせてる先のデータが削除・追加されても、そのつど SQL が実行されるわけじゃない</li>
</ul>
</li>
<li></li>
</ul>
<h2 id="fetching-data-for-the-dashboard-overview-page">fetching data for the dashboard overview page</h2>
<ul>
<li><code>export default async function Page()</code>の<code>async</code>が<code>await</code>を使えるようにする</li>
<li><code>const data = await sql&lt;Revenue&gt;`SELECT * FROM revenue`;</code>で SQL が実行できそう</li>
</ul>
<h1 id="ch8-static-and-dynamic-renderinghttpsnextjsorglearndashboard-appstatic-and-dynamic-rendering"><a href="https://nextjs.org/learn/dashboard-app/static-and-dynamic-rendering">Ch.8: Static and Dynamic Rendering</a></h1>
<ul>
<li>静的レンダリング：ユーザーが訪れるたびに、キャッシュされたのが提供される</li>
<li>メリット
<ul>
<li>早い</li>
<li>サーバーの負担が少ない</li>
<li>SEO対策になる。クローラーが喜ぶ</li>
</ul>
</li>
<li>向いてる場所
<ul>
<li>データを使わないサイト</li>
<li>みんな共通のデータ（不変）を使う</li>
</ul>
</li>
<li>動的レンダリング
<ul>
<li>クッキーとか、URL のパラメータとかの、リクエスト時にのみ得られる情報にアクセスできる</li>
<li>ただ、データのフェッチに時間がかかると、ページ読み込みもその分遅くなる</li>
</ul>
</li>
</ul>
<h1 id="ch9-streaminghttpsnextjsorglearndashboard-appstreaming"><a href="https://nextjs.org/learn/dashboard-app/streaming">Ch.9: Streaming</a></h1>
<h2 id="stream-について学ぼう">Stream について学ぼう</h2>
<ul>
<li>データを小さいまとまり（チャンク）にして、送れるぜ！になったら各々送る
<ul>
<li>早くなるよ
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fserver-rendering-with-streaming.png&w=1920&q=75">
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fserver-rendering-with-streaming-chart.png&w=1920&q=75"></li>
</ul>
</li>
<li>方法</li>
</ul>
<ol>
<li>loading.tsx ファイル</li>
</ol>
<ul>
<li><code>loading.tsx</code>は next.js の<code>Suspense</code>の特別なファイルらしい
<ul>
<li><code>page.tsx</code>みたいな、特殊な奴</li>
</ul>
</li>
</ul>
<ol start="2">
<li><code>&lt;Suspense&gt;</code>コンポーネント</li>
</ol>
<ul>
<li>何らかの条件が満たされるまで（例：データが読み込まれるまで）一部のレンダリングを延期できる</li>
<li>動的コンポーネントを Susppense でラップ、動的コンポーネントのロード中に表示するフォールバックコンポーネントを渡す</li>
</ul>
<h1 id="ch10-partial-prerenderinghttpsnextjsorglearndashboard-apppartial-prerendering"><a href="https://nextjs.org/learn/dashboard-app/partial-prerendering">Ch.10: Partial Prerendering</a></h1>
<ul>
<li>
<p>元々、ルート（ページ）全体を静的・動的レンダリングのどちらかに統一する必要があった</p>
<ul>
<li><code>if you call a dynamic function in a route (like querying your database), the entire route becomes dynamic.</code></li>
<li>でも、動的・静的どっちも使いたいね
<ul>
<li>大部分は静的に生成、一部は動的にデータ取得とか！</li>
</ul>
</li>
<li>
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fdashboard-static-dynamic-components.png&w=3840&q=75">
</li>
</ul>
</li>
<li>
<p>Partial Prerendering(PPR): Next.js 14 で登場</p>
<ul>
<li><code>Suspense</code>を使って、動的に読み込む場所のスペースを残して静的レンダリング-&gt;動的コンテンツを非同期に読み込みレンダリング</li>
</ul>
</li>
<li>
<p>使い方</p>
<ul>
<li><code>Suspense</code>で動的なのをラップしてれば、基本的にコードを変えなくてもよい</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mjs" data-lang="mjs"><span class="line"><span class="cl"><span class="c1">// next.config.mjs
</span></span></span><span class="line"><span class="cl"><span class="c1">// 追記
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">nextConfig</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">experimental</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ppr</span><span class="o">:</span> <span class="s2">&#34;incremental&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="c1">// layout.tsx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">experimental_ppr</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// 追記
</span></span></span></code></pre></div><ul>
<li>データフェッチを最適化しよう
<ol>
<li>データベースのリージョンは近所に</li>
<li><code>React Server Components</code>を使うと、ロジック・データがサーバー内のみに存在する
<ul>
<li>クライアントの JS が頑張らなくていい</li>
<li>データがクライアントに漏れる心配ない</li>
</ul>
</li>
<li>必要な分のデータは SQL で取得しよう
<ul>
<li>毎回の通信するデータが減る</li>
<li>in-memory に変換するようの JS が減る</li>
</ul>
</li>
<li>データは並列に取得しよう</li>
<li>Streaming で、重いデータが足を引っ張ってページがいつまでも表示されない&hellip;をなくそう
<ul>
<li>すべてロードされなくても、ユーザーが画面操作できるようにしたいね</li>
</ul>
</li>
<li>データフェッチを必要なコンポーネントに移すことで、どの部分をダイナミックにするかを分離できる</li>
</ol>
</li>
</ul>
<h1 id="ch11-adding-search-and-paginationhttpsnextjsorglearndashboard-appadding-search-and-pagination"><a href="https://nextjs.org/learn/dashboard-app/adding-search-and-pagination">Ch.11: Adding Search and Pagination</a></h1>
<ul>
<li>Pagination?: 検索件数がたくさんあるときに、下に出てくるあれ
<img src = "https://s3-alpha.figma.com/hub/file/3328835529/e6b30bf5-dcdd-4430-a971-97706bd0fe05-cover.png"></li>
</ul>
<h2 id="なんでurl-search-paramを使う">なんでURL search paramを使う？</h2>
<ul>
<li>他の方法として、クライアントの方でstate管理もできる</li>
<li>メリット
<ol>
<li>ブックマークや、他の人にURLでシェアできる</li>
<li>サーバーサイドレンダリングと初期読み込み：URLパラメータはサーバー上で直接処理できるから、初期の状態をレンダリングするとき便利</li>
<li>分析・トラッキング：クライアントでごちゃごちゃしなくても、クエリ・フィルターがURLに直接埋め込まれてるので、容易にユーザーの挙動を追跡できる</li>
</ol>
</li>
</ul>
<h2 id="検索機能で使う機能">検索機能で使う機能</h2>
<ul>
<li><code>useSearchParams</code>: URLのパラメータを取得可能
<ul>
<li><code>/dashboard/invoices?page=1&amp;query=pending</code> -&gt; <code>{page: '1', query: 'pending'}.</code></li>
</ul>
</li>
<li><code>usePathName</code>: 現在のURLを取得可能</li>
<li><code>useRouter</code>: ページの遷移が出来る（？）</li>
</ul>
<h2 id="debouncingディバウンシング">debouncing（ディバウンシング）</h2>
<ul>
<li>関数の発火を制限する
<ul>
<li>現状：ユーザーが一文字入力するたびに、検索している-&gt;サーバーが大変</li>
<li>理想：ユーザーが入力を止めた時に、発火させたい</li>
</ul>
</li>
<li>原理
<ol>
<li>発火：発火したら、タイマーがスタート</li>
<li>待機：もし再度発火 &amp; タイマーが時間切れじゃない -&gt; タイマーリセット</li>
<li>実行：もしタイマーが切れたら、関数実行
<code>pnpm i use-debounce</code></li>
</ol>
</li>
</ul>
<h2 id="tip-defaultvalue-vs-value">Tip: defaultValue vs value</h2>
<ul>
<li><code>value</code>: stateで入力値を管理してる
<ul>
<li>controlled components(?)にするため</li>
<li>reactがinputの状態を管理できる</li>
</ul>
</li>
<li><code>defaultValue</code>: stateで管理してない
<ul>
<li>inputのみが情報を管理・保持してる</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">input</span>
</span></span><span class="line"><span class="cl">  <span class="na">className</span><span class="o">=</span><span class="s">&#34;peer block w-full rounded-md border border-gray-200 py-[9px] pl-10 text-sm outline-2 placeholder:text-gray-500&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">placeholder</span><span class="o">=</span><span class="p">{</span><span class="nx">placeholder</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">handleSearch</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}}</span>
</span></span><span class="line"><span class="cl">  <span class="na">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">toString</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl"><span class="p">/&gt;</span>
</span></span></code></pre></div><h2 id="usesearchparams-hook-vs-searchparams-props"><code>useSearchParams</code> hook vs <code>searchParams</code> props</h2>
<ul>
<li><code>useSearchParams</code>:  クライアントコンポーネント</li>
<li><code>searchParams</code>: サーバーコンポーネント</li>
</ul>
<h1 id="ch12-mutating-data-mutate-変化するhttpsnextjsorglearndashboard-appmutating-data"><a href="https://nextjs.org/learn/dashboard-app/mutating-data">Ch.12: Mutating Data (mutate: 変化する)</a></h1>
<h2 id="server-actionとは">Server Actionとは</h2>
<ul>
<li>サーバー上でコードを非同期で実行できる
<ul>
<li>APIを作らなくてもよい！</li>
<li>クライアント/サーバーコンポーネントから実行可能</li>
</ul>
</li>
<li>どうやら、セキュリティ面もいい感じらしい
<ul>
<li>encrypted closures, strict input checks, error message hashing, and host restrictions&hellip;</li>
</ul>
</li>
</ul>
<h2 id="invoiceを作ろう">invoiceを作ろう</h2>
<ul>
<li><code>use server;</code>: エクスポートされたのが、server actionになる。
<ul>
<li>クライアント・サーバーコンポーネントにて使用可能</li>
</ul>
</li>
<li>
<h2 id="formdataの情報を取得するためにはgetnameを使う"><code>formData</code>の情報を取得するためには、<code>.get(name)</code>を使う</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="s1">&#39;use server&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">createInvoice</span><span class="p">(</span><span class="nx">formData</span>: <span class="kt">FormData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">rawFormData</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">customerId</span>: <span class="kt">formData.get</span><span class="p">(</span><span class="s1">&#39;customerId&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">amount</span>: <span class="kt">formData.get</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">status</span>: <span class="kt">formData.get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>バリデーションしたい
<ul>
<li><code>typeof rawFormData.amount</code>: 型が分かる</li>
<li><a href="https://zod.dev/">Zod</a>: バリデーションライブラリ</li>
<li></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">z</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;zod&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">rawFormData</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">customerId</span>: <span class="kt">formData.get</span><span class="p">(</span><span class="s1">&#39;customerId&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">amount</span>: <span class="kt">formData.get</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">status</span>: <span class="kt">formData.get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><ul>
<li>floatをなるべく扱わないようにしよう(intで管理できるのであれば、そうする)</li>
</ul>
</li>
<li><a href="https://nextjs.org/docs/app/building-your-application/caching#router-cache">client-side router cashe</a>
<ul>
<li>これ、良く分からない</li>
</ul>
</li>
</ul>
<h2 id="invoiceをアップデートしよう">invoiceをアップデートしよう</h2>
<ul>
<li><a href="https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes">Dynamic Route Seements</a>
<ul>
<li>正確な「segment name」を知らない &amp; ルートをデータを基に作りたい時に良い (ブログタイトル、製品ページ&hellip;)</li>
<li>
<img src="https://nextjs.org/_next/image?url=%2Flearn%2Flight%2Fedit-invoice-route.png&w=3840&q=75">
</li>
</ul>
</li>
<li>server actionにはpropsを渡せないから、bindを使う必要がある
<ul>
<li>クライアントコンポーネントから実行されなくて、サーバーで実行されるため</li>
</ul>
</li>
</ul>
<h2 id="tip-uuid-vs-auto-incrementing-key">Tip: UUID vs auto-incrementing key</h2>
<ul>
<li>auto-incrementing key: 短い</li>
<li>UUID: 長いけどたくさんのメリット
<ul>
<li>IDが衝突しない・ユニーク・列挙型攻撃に強い -&gt; 大きいDBに向いてる</li>
</ul>
</li>
</ul>
<h1 id="ch13-handling-errorshttpsnextjsorglearndashboard-apperror-handling"><a href="https://nextjs.org/learn/dashboard-app/error-handling">Ch.13: Handling Errors</a></h1>
<p><a href="https://nextjs.org/docs/app/api-reference/file-conventions/error">error.js</a>
<a href="https://nextjs.org/docs/app/api-reference/functions/not-found">notFound</a>
<a href="https://nextjs.org/docs/app/api-reference/file-conventions/not-found">not-found.js</a></p>
<h2 id="errortsx">error.tsx</h2>
<ul>
<li>エラーが発生したら表示するページ？
<ul>
<li>どんなエラーでも！</li>
</ul>
</li>
<li>fallback(前の画面に戻る？)UIを表示する</li>
<li>クライアントコンポーネント（<code>use client</code>）</li>
<li>2つのpropsを受け取る
<ul>
<li><code>error</code>: JSのError オブジェクト</li>
<li><code>reset</code>：route segment(前の画面？)を再レンダリングする</li>
</ul>
</li>
<li>ファイルを作って、中身を書く</li>
</ul>
<h2 id="notfound関数"><code>notFound</code>関数</h2>
<ul>
<li>リソースが存在しない時のみ</li>
<li>下のように、エラーが出そうなところでハンドリング、同じ階層に<code>not-found.tsx</code>を作成
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">notFound</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;next/navigation&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">invoice</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">notFound</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
<h1 id="ch14-improving-accessibilityhttpsnextjsorglearndashboard-appimproving-accessibility"><a href="https://nextjs.org/learn/dashboard-app/improving-accessibility">Ch.14: Improving Accessibility</a></h1>
<h2 id="form-validation">Form Validation</h2>
<ul>
<li><code>useActionState</code>(クライアントコンポーネントで使う)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">FormSchema</span> <span class="o">=</span> <span class="nx">z</span><span class="p">.</span><span class="kt">object</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">z.string</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">customerId</span>: <span class="kt">z.string</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">invalid_type_error</span><span class="o">:</span> <span class="s1">&#39;Please select a customer.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">amount</span>: <span class="kt">z.coerce</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="kt">number</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Please enter an amount greater than $0.&#39;</span> <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">status</span>: <span class="kt">z.enum</span><span class="p">([</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;paid&#39;</span><span class="p">],</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">invalid_type_error</span><span class="o">:</span> <span class="s1">&#39;Please select an invoice status.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">date</span>: <span class="kt">z.string</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><ul>
<li>色々な機能が、色々なファイルに散らばってて、何が何だか</li>
</ul>
<h1 id="ch15-adding-authenticationhttpsnextjsorglearndashboard-appadding-authentication"><a href="https://nextjs.org/learn/dashboard-app/adding-authentication">Ch.15: Adding Authentication</a></h1>
<h2 id="authetication-vs-authorization">Authetication vs Authorization</h2>
<ul>
<li>Authentication(認証):身分を証明する行為（ユーザー名とパスワード的な）</li>
<li>Authorization（認可）: 認証された時、アプリをどこまで使っていいか決める（？）</li>
</ul>
<h2 id="nextauthjshttpsauthjsdevreferencenextjs"><a href="https://authjs.dev/reference/nextjs">NextAuth.js</a></h2>
<ul>
<li>認証の機能を使える
<ul>
<li>セッションの管理</li>
<li>サインイン・サインアウト&hellip;</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>pnpm i next-auth@beta
</code></pre><p>下の値を.envの<code>AUTH_SECRET</code>に記入する</p>
<pre tabindex="0"><code>openssl rand -base64 32
</code></pre><ul>
<li>やることがたくさんあって、何が何だか</li>
</ul>
<h1 id="memo">memo</h1>
<h2 id="よくわからんエラー">よくわからんエラー</h2>
<pre tabindex="0"><code>Next.js (15.0.0-canary.56) is outdated (learn more)

Unhandled Runtime Error
Error: Unsupported Server Component type: undefined
</code></pre><ul>
<li>これは<code>pnpm add next@canary</code>したら直った。</li>
<li><code>npm i next@latest</code>, <code>npm i next@canary</code>は無力だった</li>
</ul>
<h2 id="import-の謎">import の謎</h2>
<p><code>import { lusitana } from '@/app/ui/fonts';</code>と <code>import CardWrapper from '@/app/ui/dashboard/cards';</code>は何が違う？
なんで二通りの書き方が存在する？</p>
<ul>
<li>前者：名前付きインポート
<ul>
<li>下みたいに、モジュールが複数のエクスポート持つときに使う</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">lusitana</span> <span class="o">=</span> <span class="s1">&#39;some-value&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">anotherFont</span> <span class="o">=</span> <span class="s1">&#39;another-value&#39;</span><span class="p">;</span>
</span></span></code></pre></div></li>
<li>後者：デフォルトインポート
<ul>
<li>モジュールが一つしかエクスポートしない時に使う</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">CardWrapper</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">CardWrapper</span><span class="p">;</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="use-client"><code>use client</code>?</h2>
<ul>
<li>イベントリスナーとフックを使えるらしい</li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='http://localhost:1313/js/toc.js'></script>
<link rel="stylesheet" href='http://localhost:1313/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="http://localhost:1313/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="http://localhost:1313/js/github-style.js"></script>







</html>